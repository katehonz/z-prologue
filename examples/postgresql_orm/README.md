# PostgreSQL ORM Example

–¢–æ–∑–∏ –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–∞ –∫–∞–∫ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞—Ç–µ –Ω–æ–≤–∞—Ç–∞ PostgreSQL ORM —Å–∏—Å—Ç–µ–º–∞ –≤ Prologue framework.

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª–Ω–∏ –∏–∑–∏—Å–∫–≤–∞–Ω–∏—è

1. **PostgreSQL —Å—ä—Ä–≤—ä—Ä** - —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞—Ç–µ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω –∏ —Ä–∞–±–æ—Ç–µ—â PostgreSQL —Å—ä—Ä–≤—ä—Ä
2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω–∏** - —Å—ä–∑–¥–∞–π—Ç–µ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏ —Å –∏–º–µ `ex-orm`
3. **Nim –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - –¥–æ–±–∞–≤–µ—Ç–µ —Å–ª–µ–¥–Ω–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `prologue.nimble`:

```nim
requires "db_connector >= 0.1.0"  # PostgreSQL –¥—Ä–∞–π–≤–µ—Ä
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏

```sql
-- –°–≤—ä—Ä–∂–µ—Ç–µ —Å–µ –∫—ä–º PostgreSQL –∫–∞—Ç–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
CREATE DATABASE "ex-orm";
CREATE USER postgres WITH PASSWORD 'azina681024';
GRANT ALL PRIVILEGES ON DATABASE "ex-orm" TO postgres;
```

## –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞

```bash
# –û—Ç root –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ç–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞
cd examples/postgresql_orm
nim c -r app.nim
```

–°—ä—Ä–≤—ä—Ä—ä—Ç —â–µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞ –Ω–∞ `http://localhost:8080`

## API Endpoints

### –û—Å–Ω–æ–≤–Ω–∏
- `GET /` - –ù–∞—á–∞–ª–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `GET /test` - –¢–µ—Å—Ç –Ω–∞ –≤—Ä—ä–∑–∫–∞—Ç–∞ —Å –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏
- `GET /stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏

### –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ (Users)
- `GET /users` - –ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
- `POST /users` - –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –Ω–æ–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª
- `GET /users/{id}` - –ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª –ø–æ ID
- `PUT /users/{id}` - –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª
- `DELETE /users/{id}` - –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª

### –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ (Posts)
- `POST /posts` - –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –Ω–æ–≤–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è
- `GET /users/{userId}/posts` - –ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª

## –ü—Ä–∏–º–µ—Ä–∏ –∑–∞ –∑–∞—è–≤–∫–∏

### –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª
```bash
curl -X POST http://localhost:8080/users \
  -H "Content-Type: application/json" \
  -d '{
    "username": "john_doe",
    "email": "john@example.com",
    "fullName": "John Doe",
    "isActive": true
  }'
```

### –ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
```bash
curl http://localhost:8080/users
```

### –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è
```bash
curl -X POST http://localhost:8080/posts \
  -H "Content-Type: application/json" \
  -d '{
    "title": "My First Post",
    "content": "This is the content of my first post",
    "authorId": 1
  }'
```

### –¢–µ—Å—Ç –Ω–∞ –≤—Ä—ä–∑–∫–∞—Ç–∞
```bash
curl http://localhost:8080/test
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞ ORM —Å–∏—Å—Ç–µ–º–∞—Ç–∞

### –ú–æ–¥–µ–ª–∏
–ú–æ–¥–µ–ª–∏—Ç–µ —Å–µ –¥–µ—Ñ–∏–Ω–∏—Ä–∞—Ç –∫–∞—Ç–æ –Ω–∞—Å–ª–µ–¥–Ω–∏—Ü–∏ –Ω–∞ –±–∞–∑–æ–≤–∏—è `Model` –∫–ª–∞—Å:

```nim
type
  User* = ref object of Model
    username*: string
    email*: string
    fullName*: string
    isActive*: bool
    createdAt*: string
```

### CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
```nim
# –°—ä–∑–¥–∞–≤–∞–Ω–µ
let user = User()
user.username = "john"
await user.save()

# –ß–µ—Ç–µ–Ω–µ
let user = await User.objects.get(1)
let users = await User.objects.all()

# –û–±–Ω–æ–≤—è–≤–∞–Ω–µ
user.email = "new@email.com"
user.markDirty()
await user.save()

# –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ
await user.delete()
```

### Query Manager
```nim
# –§–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ
let activeUsers = await User.objects.all("is_active = $1", @["true"])

# –ë—Ä–æ–µ–Ω–µ
let userCount = await User.objects.count()

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞–Ω–µ
let exists = await User.objects.exists(1)
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ —Ñ–∞–π–ª–æ–≤–µ—Ç–µ

```
examples/postgresql_orm/
‚îú‚îÄ‚îÄ app.nim          # –ì–ª–∞–≤–Ω–æ—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ README.md        # –¢–∞–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ config.nims      # Nim –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç–∏ –Ω–∞ ORM

### ‚úÖ –†–µ–∞–ª–∏–∑–∏—Ä–∞–Ω–∏
- –û—Å–Ω–æ–≤–Ω–∏ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
- Connection pooling
- PostgreSQL —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ —Ç–∏–ø–æ–≤–µ
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ú–æ–¥–µ–ª –≤–∞–ª–∏–¥–∞—Ü–∏—è
- Query manager
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ç–∞–±–ª–∏—Ü–∏

### üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- –†–µ–ª–∞—Ü–∏–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª–∏ (OneToMany, ManyToMany)
- –°–ª–æ–∂–µ–Ω Query Builder
- –ú–∏–≥—Ä–∞—Ü–∏–∏
- Lazy/Eager loading
- Batch –æ–ø–µ—Ä–∞—Ü–∏–∏

### üìã –ü–ª–∞–Ω–∏—Ä–∞–Ω–∏
- CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –º–æ–¥–µ–ª–∏
- Performance –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- Caching –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## –û—Ç—Å—Ç—Ä–∞–Ω—è–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–±–ª–µ–º–∏

### –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Å–≤—ä—Ä–∑–≤–∞–Ω–µ
```
Error: Failed to connect to PostgreSQL database
```
- –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–∞–ª–∏ PostgreSQL —Å—ä—Ä–≤—ä—Ä—ä—Ç —Ä–∞–±–æ—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ—Ç–æ –∏–º–µ –∏ –ø–∞—Ä–æ–ª–∞—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–∞–ª–∏ –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏ `ex-orm` —Å—ä—â–µ—Å—Ç–≤—É–≤–∞

### –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∫–æ–º–ø–∏–ª–∏—Ä–∞–Ω–µ
```
Error: cannot open file: db_connector/db_postgres
```
- –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—Ç–∞: `nimble install db_connector`

### –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞
```
Error: relation "users" already exists
```
- –¢–æ–≤–∞ –µ –Ω–æ—Ä–º–∞–ª–Ω–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ - —Ç–∞–±–ª–∏—Ü–∏—Ç–µ –≤–µ—á–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—Ç

## –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ó–∞ –ø–æ–≤–µ—á–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç–Ω–æ—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞—Ç–∞ –∏ –ø–ª–∞–Ω–∏—Ä–∞–Ω–∏—Ç–µ –ø–æ–¥–æ–±—Ä–µ–Ω–∏—è, –≤–∏–∂—Ç–µ:
- `POSTGRESQL_ORM_ARCHITECTURE_PLAN.md` –≤ root –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ç–∞
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è—Ç–∞ –Ω–∞ Prologue framework
- PostgreSQL –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∑–∞ —Ç–∏–ø–æ–≤–µ –¥–∞–Ω–Ω–∏ –∏ –∑–∞—è–≤–∫–∏